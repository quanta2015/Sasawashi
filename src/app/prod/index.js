import React,{useState,useEffect} from 'react';import { inject,observer,MobXProviderContext } from 'mobx-react'import { searchParams,useLocation,useNavigate } from "react-router-dom"import { Form, Input, Button, message,Select,InputNumber } from 'antd'import classnames from 'classnames';import {API_SERVER} from '@/constant/apis'import { MENU_LIST } from '@/constant/data'import { PROD_LIST } from '@/constant/prod'import {getFilter} from '@/util/fn'import s from './index.module.less';import Slide     from '@/component/Slide'import TitleLine from '@/component/TitleLine'import ToTop     from '@/component/ToTop'import right from '@/img/right.svg'const toOpt = (list) =>  list.map((item,i)=> item = {label:item, value: item} )let _PROD_LIST = [...PROD_LIST]_PROD_LIST.map((item,i)=>{  item.imgList = JSON.parse(item.imgList)  item.clrList = JSON.parse(item.clrList)  item.cltList = JSON.parse(item.cltList)  item.sizeList = JSON.parse(item.sizeList)  item.intr = JSON.parse(item.intr)})const width = '850'const slidelist = [{  name:'ルームブーツ',  spec: '足がムレない、心地よいサラサラ感',  img: 'slide_1.jpg',  link: '#',  btn: '商品を見る'},{  name:'ルームブーツ',  spec: '足がムレない、心地よいサラサラ感',  img: 'slide_2.jpg',  link: '#',  btn: '商品を見る'},{  name:'ルームブーツ',  spec: '足がムレない、心地よいサラサラ感',  img: 'slide_3.jpg',  link: '#',  btn: '商品を見る'}]const Prod = () => {  const navigate = useNavigate();  const [filter,setFilter] = useState({})  const [prodList,setProdList] = useState([])  const [sel,setSel] = useState(0)  const [selIcon,setSelIcon] = useState(0)  const [show,setShow] = useState(false)  const [prod,setProd] = useState(_PROD_LIST[0])    const menuList = MENU_LIST[0].submenu.slice(1)  const location = useLocation();  useEffect(() => {    let f = getFilter(location.search)    let list = _PROD_LIST.filter(o=>o[f.key] === f.val)    setProdList(list)    setFilter(f)  }, [location.search]);  const doSelSubMenu=(item,type)=>{    setShow(false)    navigate(`/prod?${type}=${item.url}&name=${item.jp}`)  }    const doSelProd =(item,i)=>{    setProd(item)    setSel(i)    setShow(true)    window.scrollTo({ top: 0 });  }  const doClose =(item,i)=>{    setShow(false)    window.scrollTo({ top: 0 });  }  return (    <section>      <div className={s.prod}>        <div className={s.prodWrap}>          <div className={s.sideBar}>          {menuList.map((item,i)=>            <div key={i} className={s.menu}>              <div className={s.menuTitle} onClick={()=>doSelSubMenu(item,'sub')}>                <img src={item.icon} />                <span>{item.jp}</span>              </div>              <div className={s.menuList}>                {item.list.map((o,j)=>                  <span key={j}                     className={s.menuItem}                     onClick={()=>doSelSubMenu(o,'type')}                    >                    {o.jp}                  </span>                  )}              </div>            </div>          )}          </div>          {/*产品列表*/}          {!show &&          <div className={s.prodMain}>            <TitleLine title={filter?.name} type='bottom'/>            {filter.key === 'sub' && <Slide width={width} list={slidelist} />}            <div className={s.prodList}>              {prodList.map((item,i)=>                <div key={i} className={s.prodItem} onClick={()=>doSelProd(item,i)}>                  <img src={item.imgList[0]} />                  <p>                    <span>{item.name}</span>                    <span>{item.price}</span>                  </p>                </div>              )}            </div>          </div>}          {show &&          <div className={s.prodDetail}>                        <div className={s.itemInfo}>              <div className={s.left}>                <img src={prod?.imgList[selIcon]} />                <div className={s.iconList}>                  {prod?.imgList.map((item,i)=>                    <img src={item} key={i}                       className={selIcon===i?'sel':''}                       onClick={()=>setSelIcon(i)}                      />                    )}                </div>              </div>              <div className={s.right}>                                <span className={s.type}>{prod?.type}</span>                <h1>{prod?.name}</h1>                <span className={s.price}>{prod?.price}</span>                <span className={s.desc}>{prod?.desc}</span>                <label>カラー</label>                <div className={s.clr}>                  {prod?.clrList.map((item,i)=>                    <div className={s.clrItem} key={i}>                      <img src={item} />                      <span>{prod?.cltList[i]}</span>                    </div>                  )}                </div>                <label>サイズ</label>                <div className={s.size}>                  {prod?.sizeList.map((item,i)=>                    <span key={i}>{item}</span>                  )}                </div>                <div className={s.form}>                                    <div className={s.row}>                    <label>カラー</label>                    <Select                      style ={{width: '100%'}}                      options={toOpt(prod?.cltList)}                    />                  </div>                  <div className={s.row}>                    <label>サイズ</label>                    <Select                      style ={{width: '100%'}}                      options={toOpt(prod?.sizeList)}                    />                  </div>                  <div className={s.row}>                    <label>数量</label>                    <InputNumber                        style ={{width: '100%'}}                      defaultValue={1}                        />                  </div>                  <div className={s.fun}>                    <span className={s.btnCart}>カートにいれる</span>                    <span className={s.btnLog}>♥ お気に入りに登録する</span>                    <span className={s.btnLog} onClick={doClose}>返 回</span>                  </div>                </div>              </div>            </div>            <div className={s.itemDetail}>              {prod?.intr.map((item,i)=>                <div className={s.wrap} key={i}>                  <TitleLine title={item.key} type='all'/>                  { typeof(item.val)==='string' &&                     <div className={s.par}>{item.val}</div>                  }                  { typeof(item.val)!=='string' && item.key !== 'その他' &&                    <div className={s.list}>                      {item.val.map((o,j)=>                        <React.Fragment key={j}>                          <label>{o.t}</label>                          <span>{o.p}</span>                        </React.Fragment >                        )}                    </div>                  }                  { item.key === 'その他' &&                    <div className={s.tab}>                      {item.val.map((o,j)=>                        <div key={j} className={s.row}>                          <label>{o.key}</label>                          <span>{o.val}</span>                        </div >                        )}                    </div>                  }                </div>              )}            </div>          </div>}        </div>        <ToTop />      </div>    </section>  )}export default  inject('store')(observer(Prod))